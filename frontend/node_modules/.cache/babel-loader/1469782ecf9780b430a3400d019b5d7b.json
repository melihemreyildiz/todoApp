{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport Vue from 'vue';\nimport Vuex from 'vuex';\nimport router from \"../router\";\nimport axios from \"axios\";\nVue.use(Vuex);\nexport default new Vuex.Store({\n  state: {\n    token: \"\"\n  },\n  getters: {\n    isAuthenticated: function isAuthenticated(state) {\n      return state.token !== \"\";\n    }\n  },\n  mutations: {\n    setToken: function setToken(state, token) {\n      state.token = token;\n    },\n    clearToken: function clearToken(state) {\n      state.token = \"\";\n    }\n  },\n  actions: {\n    initAuth: function initAuth(_ref) {\n      var commit = _ref.commit,\n          dispatch = _ref.dispatch;\n      var token = localStorage.getItem(\"token\");\n\n      if (token) {\n        axios.defaults.headers.common['Authorization'] = \"Bearer \" + token;\n        var expirationDate = localStorage.getItem(\"expirationDate\");\n        var time = new Date().getTime();\n\n        if (time >= +expirationDate) {\n          console.log(\"token süresi geçmiş...\");\n          dispatch(\"logout\");\n        } else {\n          commit(\"setToken\", token);\n          var timerSecond = +expirationDate - time;\n          console.log(timerSecond);\n          dispatch(\"setTimeoutTimer\", timerSecond);\n          router.push(\"/\");\n        }\n      } else {\n        router.push(\"/auth\");\n        return false;\n      }\n    },\n    login: function login(_ref2, authData) {\n      var commit = _ref2.commit,\n          dispatch = _ref2.dispatch,\n          state = _ref2.state;\n      var authLink = \"/api/authentication/login/\";\n      return axios.post(authLink, {\n        email: authData.email,\n        password: authData.password\n      }).then(function (response) {\n        // console.log(response.data)\n        commit(\"setToken\", response.data.idToken);\n        localStorage.setItem(\"token\", response.data.idToken);\n        localStorage.setItem(\"expirationDate\", new Date().getTime() + +response.data.expiresIn * 1000); // localStorage.setItem(\"expirationDate\", new Date().getTime() + 10000)\n\n        dispatch(\"setTimeoutTimer\", +response.data.expiresIn * 1000); // dispatch(\"setTimeoutTimer\", 10000)\n      });\n    },\n    logout: function logout(_ref3) {\n      var commit = _ref3.commit;\n      commit(\"clearToken\");\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"expirationDate\");\n      router.replace(\"/auth\");\n    },\n    setTimeoutTimer: function setTimeoutTimer(_ref4, expiresIn) {\n      var dispatch = _ref4.dispatch;\n      setTimeout(function () {\n        dispatch(\"logout\");\n      }, expiresIn);\n    }\n  },\n  modules: {}\n});","map":{"version":3,"sources":["/home/emre/PycharmProjects/djangoProject/frontend/project/src/store/index.js"],"names":["Vue","Vuex","router","axios","use","Store","state","token","getters","isAuthenticated","mutations","setToken","clearToken","actions","initAuth","commit","dispatch","localStorage","getItem","defaults","headers","common","expirationDate","time","Date","getTime","console","log","timerSecond","push","login","authData","authLink","post","email","password","then","response","data","idToken","setItem","expiresIn","logout","removeItem","replace","setTimeoutTimer","setTimeout","modules"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport router from \"../router\"\nimport axios from \"axios\";\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n    state: {\n        token: \"\",\n    },\n    getters: {\n        isAuthenticated(state){\n            return state.token !== \"\"\n        }\n    },\n    mutations: {\n        setToken(state, token) {\n            state.token = token\n        },\n        clearToken(state) {\n            state.token = \"\"\n        }\n    },\n    actions: {\n        initAuth({commit, dispatch}) {\n            let token = localStorage.getItem(\"token\")\n            if (token) {\n                axios.defaults.headers.common['Authorization'] = \"Bearer \" + token\n                let expirationDate = localStorage.getItem(\"expirationDate\")\n                let time = new Date().getTime()\n\n                if (time >= +expirationDate) {\n                    console.log(\"token süresi geçmiş...\")\n                    dispatch(\"logout\")\n                } else {\n                    commit(\"setToken\", token)\n                    let timerSecond = +expirationDate - time\n                    console.log(timerSecond)\n                    dispatch(\"setTimeoutTimer\", timerSecond)\n                    router.push(\"/\")\n                }\n\n            } else {\n                router.push(\"/auth\")\n                return false\n            }\n        },\n        login({commit, dispatch, state}, authData) {\n            let authLink = \"/api/authentication/login/\"\n            return axios.post(\n                authLink ,\n                {email: authData.email, password: authData.password}\n            ).then(response => {\n                // console.log(response.data)\n                commit(\"setToken\", response.data.idToken)\n                localStorage.setItem(\"token\", response.data.idToken)\n\n                localStorage.setItem(\"expirationDate\", new Date().getTime() + +response.data.expiresIn * 1000)\n                // localStorage.setItem(\"expirationDate\", new Date().getTime() + 10000)\n\n                dispatch(\"setTimeoutTimer\", +response.data.expiresIn * 1000)\n                // dispatch(\"setTimeoutTimer\", 10000)\n            })\n        },\n        logout({commit}) {\n            commit(\"clearToken\")\n            localStorage.removeItem(\"token\")\n            localStorage.removeItem(\"expirationDate\")\n            router.replace(\"/auth\")\n        },\n        setTimeoutTimer({dispatch}, expiresIn) {\n            setTimeout(() => {\n                dispatch(\"logout\")\n            }, expiresIn)\n        }\n\n    },\n    modules: {}\n})\n"]},"metadata":{},"sourceType":"module"}